angular.module("todoApp.controllers",[]),angular.module("todoApp.services",[]);var baseUrl="http://recruiting-api.nextcapital.com",todoApp=angular.module("todoApp",["ngRoute","ngResource","ui.sortable","todoApp.controllers","todoApp.services"]);todoApp.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/auth.html",controller:"AuthCtrl"}).when("/todos",{templateUrl:"views/todos.html",controller:"TodosCtrl"})}]),todoApp.run(["$rootScope","$location","auth",function(a,b,c){a.$on("$routeChangeStart",function(){b.path(c.isAuthenticated()?"/todos":"/")})}]),angular.module("todoApp.controllers").controller("AuthCtrl",["$scope","$location","auth",function(a,b,c){a.authorize=function(a,d){c.request(a,d).then(function(){b.path("/todos")},function(a){a.error?alert(a.error):a.email&&alert("Email "+a.email[0])})}}]),angular.module("todoApp.controllers").controller("TodosCtrl",["$scope","$location","todos","auth",function(a,b,c,d){var e=function(){c.request("get",c.requestUrl()).then(function(b){a.todos=b},function(a){alert(a.error)})};d.isAuthenticated()&&e(),a.createTodo=function(b){var b=c.sanitizeData(b);c.request("post",c.createUrl(),b).then(function(b){a.todo="",a.todos.push(b)},function(a){alert(a.error)})},a.edit=function(b,c){a.todos[a.prevEditableTodoIndex||0].editable=!1,a.prevEditableTodoIndex=c,a.editableTodo=angular.copy(b),b.editable=!0},a.cancelEdit=function(b){b.editable=!1,a.editableTodo=null},a.updateTodo=function(b,d){var e=c.sanitizeData(b);c.request("put",c.updateUrl(e.todo.id),e).then(function(b){a.todos[d]=b},function(a){alert(a.error)})},a.signOut=function(){d.signOut().then(function(){b.path("/")},function(a){alert(a.error)})}}]),angular.module("todoApp.services").factory("auth",["$http","$location","$window","$q",function(a,b,c,d){var e={};e.request=function(b,c){var e=d.defer();return a.post(baseUrl+"/users"+c,b).success(function(a){f(a.id,a.api_token),e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},e.signOut=function(){var b=d.defer(),e={user_id:c.sessionStorage.userId,api_token:c.sessionStorage.apiToken},f={Accept:"*/*","Content-Type":"application/json"};return a.delete(baseUrl+"/users/sign_out",{headers:f,data:e}).success(function(){c.sessionStorage.clear(),b.resolve()}).error(function(a){b.reject(a)}),b.promise},e.isAuthenticated=function(){return c.sessionStorage.userId&&c.sessionStorage.apiToken?!0:!1};var f=function(a,b){c.sessionStorage.userId=a,c.sessionStorage.apiToken=b};return e}]),angular.module("todoApp.services").factory("todos",["$http","$q","$window",function(a,b,c){var d={};return d.request=function(c,d,e){var f=b.defer();return a[c](d,e).success(function(a){f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},d.sanitizeData=function(a){return{api_token:c.sessionStorage.apiToken,todo:a}},d.requestUrl=function(){return this.createUrl()+"?api_token="+c.sessionStorage.apiToken},d.createUrl=function(){return baseUrl+"/users/"+c.sessionStorage.userId+"/todos"},d.updateUrl=function(a){return this.createUrl()+"/"+a},d}]);